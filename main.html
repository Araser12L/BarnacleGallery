<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Barnacle Gallery â€” Legendary Art Platform</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg: #0a0e14;
      --surface: #12181f;
      --panel: #1a222c;
      --border: #2d3a48;
      --text: #e6eaf0;
      --muted: #6b7a8c;
      --coral: #ff7b72;
      --coral-dim: #e06c6c;
      --teal: #6ee7b7;
      --gold: #fcd34d;
      --radius: 12px;
      --font-sans: "Syne", system-ui, sans-serif;
      --font-mono: "DM Mono", monospace;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.55;
      background-image:
        radial-gradient(ellipse 90% 50% at 50% -20%, rgba(255, 123, 114, 0.06), transparent 55%),
        radial-gradient(ellipse 50% 40% at 100% 80%, rgba(110, 231, 183, 0.05), transparent 45%);
    }
    .app {
      max-width: 820px;
      margin: 0 auto;
      padding: 1.5rem;
      min-height: 100vh;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 0.65rem;
    }
    .logo-emoji { font-size: 1.75rem; }
    .logo-text {
      font-weight: 800;
      font-size: 1.4rem;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--coral), var(--teal));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .tagline { font-size: 0.75rem; color: var(--muted); margin-top: 0.15rem; }
    .wallet-row { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; }
    .addr { font-family: var(--font-mono); font-size: 0.8rem; color: var(--muted); max-width: 140px; overflow: hidden; text-overflow: ellipsis; }
    .btn {
      font-family: var(--font-sans);
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    .btn:hover { background: var(--surface); border-color: var(--coral); }
    .btn-primary {
      background: linear-gradient(135deg, #c94a47, #ff7b72);
      border-color: var(--coral);
      color: #fff;
    }
    .btn-primary:hover { box-shadow: 0 0 20px rgba(255, 123, 114, 0.3); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      margin-bottom: 1rem;
    }
    .card h2 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: var(--coral);
    }
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .stat {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.65rem;
      text-align: center;
    }
    .stat-label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .stat-value { font-family: var(--font-mono); font-size: 0.95rem; margin-top: 0.2rem; }
    input[type="text"], input[type="number"] {
      width: 100%;
      font-family: var(--font-mono);
      font-size: 0.88rem;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--surface);
      color: var(--text);
      margin-bottom: 0.5rem;
    }
    input::placeholder { color: var(--muted); }
    label { display: block; font-size: 0.78rem; color: var(--muted); margin-bottom: 0.25rem; }
    .form-row { margin-bottom: 0.7rem; }
    .msg { font-size: 0.85rem; padding: 0.5rem; border-radius: var(--radius); margin-top: 0.5rem; }
    .msg.err { background: rgba(239, 68, 68, 0.12); color: #f87171; }
    .msg.ok { background: rgba(34, 197, 94, 0.12); color: var(--teal); }
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .tab {
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--muted);
      cursor: pointer;
      font-weight: 600;
    }
    .tab.active { background: var(--panel); color: var(--coral); border-color: var(--coral); }
    .tab:hover:not(.active) { color: var(--text); }
    .tab-content { display: none; }
    .tab-content.visible { display: block; }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
      margin-top: 0.75rem;
    }
    .art-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.75rem;
      font-size: 0.8rem;
    }
    .art-card .id { font-family: var(--font-mono); color: var(--muted); }
    .art-card .price { color: var(--teal); margin-top: 0.35rem; }
    .art-card .owner { font-size: 0.7rem; color: var(--muted); margin-top: 0.25rem; overflow: hidden; text-overflow: ellipsis; }
    .list-compact { font-family: var(--font-mono); font-size: 0.8rem; color: var(--muted); }
    .list-compact div { padding: 0.35rem 0; border-bottom: 1px solid var(--border); }
    .list-compact div:last-child { border-bottom: none; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">
        <span class="logo-emoji">ðŸ¦ª</span>
        <div>
          <div class="logo-text">Barnacle Gallery</div>
          <div class="tagline">Legendary art generator â€” mint, list, collect</div>
        </div>
      </div>
      <div class="wallet-row">
        <span id="wallet-addr" class="addr">â€”</span>
        <button id="btn-connect" class="btn">Connect</button>
      </div>
    </header>

    <div class="card">
      <h2>Contract</h2>
      <div class="form-row">
        <label>LegendaryBarnacle contract address</label>
        <input type="text" id="contract-address" placeholder="0xâ€¦" />
      </div>
      <button id="btn-set-contract" class="btn btn-primary">Set contract</button>
      <div id="contract-msg"></div>
    </div>

    <div class="card">
      <h2>Platform stats</h2>
      <div class="stats-row">
        <div class="stat"><div class="stat-label">Artists</div><div id="stat-artists" class="stat-value">â€”</div></div>
        <div class="stat"><div class="stat-label">Artworks</div><div id="stat-artworks" class="stat-value">â€”</div></div>
        <div class="stat"><div class="stat-label">Galleries</div><div id="stat-galleries" class="stat-value">â€”</div></div>
        <div class="stat"><div class="stat-label">Paused</div><div id="stat-paused" class="stat-value">â€”</div></div>
      </div>
    </div>

    <div class="card">
      <h2>Actions</h2>
      <div class="tabs">
        <button class="tab active" data-tab="register">Register artist</button>
        <button class="tab" data-tab="gallery">Create gallery</button>
        <button class="tab" data-tab="mint">Mint artwork</button>
        <button class="tab" data-tab="list">List in gallery</button>
        <button class="tab" data-tab="purchase">Purchase</button>
        <button class="tab" data-tab="withdraw">Withdraw</button>
      </div>

      <div id="panel-register" class="tab-content visible">
        <div class="form-row">
          <label>Handle hash (bytes32 hex, e.g. 0xâ€¦ or leave empty for zero)</label>
          <input type="text" id="register-handle" placeholder="0x0000â€¦0000" />
        </div>
        <button id="btn-register" class="btn btn-primary">Register as artist</button>
      </div>

      <div id="panel-gallery" class="tab-content">
        <div class="form-row">
          <label>Gallery name hash (bytes32 hex)</label>
          <input type="text" id="gallery-name" placeholder="0xâ€¦" />
        </div>
        <div class="form-row">
          <label>Commission (bps, max 2500)</label>
          <input type="text" id="gallery-commission" placeholder="500" />
        </div>
        <button id="btn-create-gallery" class="btn btn-primary">Create gallery</button>
      </div>

      <div id="panel-mint" class="tab-content">
        <div class="form-row"><label>Gallery ID (0 = no gallery)</label><input type="text" id="mint-gallery" placeholder="0" /></div>
        <div class="form-row"><label>Metadata hash (bytes32)</label><input type="text" id="mint-metadata" placeholder="0xâ€¦" /></div>
        <div class="form-row"><label>Mint price (wei or ether)</label><input type="text" id="mint-price" placeholder="0.01" /></div>
        <div class="form-row"><label>Royalty (bps, max 2000)</label><input type="text" id="mint-royalty" placeholder="500" /></div>
        <button id="btn-mint" class="btn btn-primary">Mint artwork</button>
      </div>

      <div id="panel-list" class="tab-content">
        <div class="form-row"><label>Artwork ID</label><input type="text" id="list-artwork" placeholder="1" /></div>
        <div class="form-row"><label>Gallery ID</label><input type="text" id="list-gallery" placeholder="1" /></div>
        <div class="form-row"><label>List price (wei or ether)</label><input type="text" id="list-price" placeholder="0.02" /></div>
        <button id="btn-list" class="btn btn-primary">List in gallery</button>
      </div>

      <div id="panel-purchase" class="tab-content">
        <div class="form-row"><label>Artwork ID</label><input type="text" id="purchase-artwork" placeholder="1" /></div>
        <div class="form-row"><label>Send ETH (must be â‰¥ list price)</label><input type="text" id="purchase-value" placeholder="0.02" /></div>
        <button id="btn-purchase" class="btn btn-primary">Purchase artwork</button>
      </div>

      <div id="panel-withdraw" class="tab-content">
        <p style="font-size:0.85rem; color: var(--muted); margin-bottom: 0.75rem;">Withdraw your pending artist or gallery proceeds.</p>
        <button id="btn-withdraw-artist" class="btn btn-primary">Withdraw artist proceeds</button>
        <button id="btn-withdraw-gallery" class="btn">Withdraw gallery proceeds</button>
        <div class="form-row" style="margin-top:0.75rem;"><label>Gallery ID (for gallery withdraw)</label><input type="text" id="withdraw-gallery-id" placeholder="1" /></div>
      </div>

      <div id="action-msg" class="msg" style="margin-top:0.75rem;"></div>
    </div>

    <div class="card">
      <h2>Gallery â€” listed artworks</h2>
      <div class="form-row">
        <label>Gallery ID</label>
        <input type="text" id="view-gallery-id" placeholder="1" />
      </div>
      <button id="btn-load-listed" class="btn">Load listed artworks</button>
      <div id="listed-result" class="gallery-grid"></div>
    </div>

    <div class="card">
      <h2>My artworks</h2>
      <button id="btn-load-owned" class="btn">Load my owned artwork IDs</button>
      <div id="owned-list" class="list-compact" style="margin-top:0.5rem;"></div>
    </div>

    <div class="card">
      <h2>My pending proceeds</h2>
      <button id="btn-load-proceeds" class="btn">Refresh</button>
      <div id="proceeds-display" class="list-compact" style="margin-top:0.5rem;"></div>
    </div>
  </div>

  <script>
    (function() {
      const ABI = [
        "function registerArtist(bytes32 handleHash) external returns (uint256 artistId)",
        "function createGallery(bytes32 nameHash, uint256 commissionBps) external returns (uint256 galleryId)",
        "function mintArtwork(uint256 galleryId, bytes32 metadataHash, uint256 mintPriceWei, uint256 royaltyBps, bytes32[] calldata traitKeys, bytes32[] calldata traitValues) external payable returns (uint256 artworkId)",
        "function listInGallery(uint256 artworkId, uint256 galleryId, uint256 listPriceWei) external",
        "function delist(uint256 artworkId) external",
        "function purchaseArtwork(uint256 artworkId) external payable",
        "function withdrawArtistProceeds() external",
        "function withdrawGalleryProceeds(uint256 galleryId) external",
        "function artistCounter() external view returns (uint256)",
        "function artworkCounter() external view returns (uint256)",
        "function galleryCounter() external view returns (uint256)",
        "function platformPaused() external view returns (bool)",
        "function getListedArtworkIdsInGallery(uint256 galleryId) external view returns (uint256[] memory)",
        "function getOwnedArtworkIds(address account) external view returns (uint256[] memory)",
        "function getPendingArtistProceeds(address artist) external view returns (uint256)",
        "function getPendingGalleryProceeds(uint256 galleryId) external view returns (uint256)",
        "function getArtworkRecord(uint256 artworkId) external view returns (address artist, uint256 galleryId, bytes32 metadataHash, uint256 mintPriceWei, uint256 royaltyBps, uint256 mintedAtBlock, address currentOwner, uint256 listPriceWei, uint256 listedAtGalleryId, bool listed)",
        "function listPriceForArtwork(uint256 artworkId) external view returns (uint256)",
        "function artistIdByAddress(address) external view returns (uint256)",
        "event ArtworkMinted(uint256 indexed artworkId, address indexed artist, uint256 galleryId, bytes32 metadataHash, uint256 mintPriceWei, uint256 atBlock)",
        "event GalleryCreated(uint256 indexed galleryId, address indexed curator, bytes32 nameHash, uint256 commissionBps, uint256 atBlock)"
      ];

      let provider, signer, contractAddress = "", contract = null;

      const walletEl = document.getElementById("wallet-addr");
      const btnConnect = document.getElementById("btn-connect");
      const contractInput = document.getElementById("contract-address");
      const btnSetContract = document.getElementById("btn-set-contract");
      const contractMsg = document.getElementById("contract-msg");
      const actionMsg = document.getElementById("action-msg");

      function showMsg(container, text, type) {
        container.innerHTML = text ? "<div class=\"msg " + type + "\">" + text + "</div>" : "";
      }

      document.querySelectorAll(".tab").forEach(function(tab) {
        tab.addEventListener("click", function() {
          document.querySelectorAll(".tab").forEach(function(t) { t.classList.remove("active"); });
          document.querySelectorAll(".tab-content").forEach(function(c) { c.classList.remove("visible"); });
          tab.classList.add("active");
          var panel = document.getElementById("panel-" + tab.dataset.tab);
          if (panel) panel.classList.add("visible");
        });
      });

      btnSetContract.addEventListener("click", function() {
        var addr = (contractInput.value || "").trim();
        if (!addr || !addr.startsWith("0x")) {
          showMsg(contractMsg, "Enter a valid contract address (0xâ€¦).", "err");
          return;
        }
        contractAddress = addr;
        contract = new ethers.Contract(addr, ABI, signer || provider);
        showMsg(contractMsg, "Contract set.", "ok");
        refreshStats();
      });

      async function connect() {
        if (typeof window.ethereum === "undefined") {
          showMsg(contractMsg, "Install MetaMask or another Web3 wallet.", "err");
          return;
        }
        try {
          provider = new ethers.BrowserProvider(window.ethereum);
          var accounts = await provider.send("eth_requestAccounts", []);
          if (!accounts.length) return;
          signer = await provider.getSigner();
          var addr = await signer.getAddress();
          walletEl.textContent = addr.slice(0, 6) + "â€¦" + addr.slice(-4);
          btnConnect.textContent = "Connected";
          btnConnect.disabled = true;
          if (contractAddress) {
            contract = new ethers.Contract(contractAddress, ABI, signer);
            refreshStats();
          }
        } catch (e) {
          showMsg(contractMsg, e.message || "Connection failed.", "err");
        }
      }
      btnConnect.addEventListener("click", connect);

      async function refreshStats() {
        if (!contract || !provider) return;
        try {
          var artists = await contract.artistCounter();
          var artworks = await contract.artworkCounter();
          var galleries = await contract.galleryCounter();
          var paused = await contract.platformPaused();
          document.getElementById("stat-artists").textContent = artists.toString();
          document.getElementById("stat-artworks").textContent = artworks.toString();
          document.getElementById("stat-galleries").textContent = galleries.toString();
          document.getElementById("stat-paused").textContent = paused ? "Yes" : "No";
        } catch (_) {
          document.getElementById("stat-artists").textContent =
          document.getElementById("stat-artworks").textContent =
          document.getElementById("stat-galleries").textContent =
          document.getElementById("stat-paused").textContent = "â€”";
        }
      }

